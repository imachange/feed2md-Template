name: ãƒ•ã‚£ãƒ¼ãƒ‰å–å¾—

on:
  # 6æ™‚é–“ã”ã¨ã«å®Ÿè¡Œ
  schedule:
    - cron: '0 */6 * * *'
  
  # æ‰‹å‹•å®Ÿè¡Œã‚’è¨±å¯
  workflow_dispatch:
  
  # ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«ã‚‚å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
  push:
    branches:
      - main
    paths:
      - 'feed/**/*.md'
      - 'src/**'
      - 'templates/**'

jobs:
  fetch-feeds:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
      
      - name: pnpmã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      
      - name: ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: pnpm install --frozen-lockfile
      
      - name: ãƒ•ã‚£ãƒ¼ãƒ‰ã®å–å¾—ã¨å¤‰æ›
        run: pnpm run fetch
      
      - name: å¤‰æ›´ã®ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add feed/
          if git diff --staged --quiet; then
            echo "å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“"
          else
            git commit -m "ğŸ”„è‡ªå‹•æ›´æ–°: ãƒ•ã‚£ãƒ¼ãƒ‰å–å¾— $(date '+%Y-%m-%d %H:%M:%S')"
            git push
          fi
